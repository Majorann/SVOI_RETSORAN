# История изменений


## 2026-02-11

### Редизайн UI (тёплая тёмная тема)
- Интерфейс переведён на тёплую тёмную палитру без синего неона.
- Обновлены токены цветов, контраст, поверхности и бордеры в `backend/static/css/style.css`.
- На главной странице пересобран порядок секций и улучшена визуальная иерархия в `backend/templates/index.html`.

### Типографика
- Весь интерфейс переведён на шрифт Inter:
  - подключение шрифта в `backend/templates/base.html`;
  - обновление `font-family` в `backend/static/css/style.css`.

### Схема зала и бронирование
- Доработана панель бронирования на схеме:
  - улучшены размеры, позиционирование и стабильность отображения;
  - исправлены отступы и внутренний layout формы.
- Восстановлен и усилен blur схемы:
  - общий blur при активной панели;
  - дополнительное затемнение и усиление blur во время ввода данных (`is-typing`).
- Доработан неон от столиков:
  - центр свечения привязан к выбранному столику;
  - улучшена форма свечения и убраны артефакты прямоугольного контейнера;
  - настроена интенсивность свечения для свободных и занятых столиков.

### Динамика фона по времени
- Реализована смена фона по выбранному времени бронирования (09:00–22:00) в `backend/static/js/app.js`.
- Добавлено мягкое смешивание оттенка времени с базовым фоном без резкой границы в `backend/static/css/style.css`.
- Обновлена палитра утро/день/вечер/ночь под медно-терракотовые тона.

### Анимации и взаимодействие
- Добавлен плавный индикатор активного раздела в нижней навигации (перетекающая капсула).
- Добавлена плавная анимация выбора времени в правом таймлайне (`timeline__active-indicator`).

### Нижняя навигация
- Нижняя навигация переведена в режим «только иконки» (без текста и эмодзи).
- Подключены PNG-иконки:
  - `backend/static/img/bell.png`
  - `backend/static/img/home.png`
  - `backend/static/img/profile.png`
- Настроены размеры иконок и позиционирование бейджа уведомлений.

### Статусы и цветовая система
- Унифицированы зелёные/красные статусы интерфейса:
  - зелёный: `#5E7F63`;
  - красный: `#7A3E3E`.
- Обновлены состояния кнопок, таймлайна, статусов столов и ошибок в едином стиле.

## 2026-02-12

### Исправления багов и ошибок

- Исправлен заметный микросдвиг нижней навигации между страницами:
  - добавлены `scrollbar-gutter: stable` и fallback `overflow-y: scroll` в `style.css`.
- Исправлено позиционирование неона на схеме зала:
  - центр неона теперь вычисляется от `.hall__map`, а не от контейнера свечения.
- Исправлен конфликт и дублирование неон-слоев на схеме:
  - удален первый (устаревший) блок фонового неона, оставлен один актуальный.
- Исправлен профиль красного неона занятых столов:
  - красный свет использует ту же геометрию свечения, что и зеленый, меняется только цвет.
- Исправлен визуальный разрез между фото блюда и фоном карточки при hover:
  - скорректированы размеры и смещение переходного градиента (`мыло`) и параметры масштаба.
- Исправлена видимость красного фонового tint:
  - эффект оставлен только на странице выбора столика (`/reserve`), убран с остальных страниц.
- Исправлены проблемы с текстовой кодировкой в `app.py`.

### Улучшения интерфейса и UX

- Главная:
  - переработан блок «Меню → Популярное»:
    - `type` вынесен в строку заголовка рядом с названием блюда;
    - обновлен стиль `type` (белый текст, рамка `rgb(216,163,127)`).
- Профиль:
  - добавлена кнопка удаления карты справа в каждой карточке оплаты;
  - стилизована как закругленный квадрат;
  - добавлена иконка мусорки из `static/img/trash.png`;
  - добавлен серверный маршрут `POST /cards/delete` с удалением карты и корректным пересчетом `active`.
- Меню:
  - полностью обновлен блок управления:
    - фильтр категорий в виде горизонтальных chips;
    - отдельный компактный dropdown сортировки;
    - сортировка: `По популярности`, `Цена ↑`, `Цена ↓`;
    - фильтр и сортировка работают совместно без перезагрузки;
    - добавлена анимация перестройки карточек (`fade + slide`, ~180ms).
  - добавлена поддержка популярности в модели блюда:
    - поля `popularity/orders_count` читаются из `menu_items/*/item.txt`.
  - hover-стиль карточек меню доработан:
    - `lore` становится белым;
    - фон карточки в hover: `#3C342D`;
    - увеличен масштаб карточки на hover;
    - неон у карточки переведен в тон акцента (`#cc7b57`) и вынесен под карточку (светит в фон).
  - активные filter-chip получили неоновую подсветку акцентного цвета.
- Промо и акции:
  - добавлен формат `promo_items` с поддержкой:
    - `reklama`: `text`, `link`;
    - `akciya`: `name`, `lore`;
    - опционального `photo.png`.
  - добавлена загрузка promo-блоков в `app.py` и преобразование в карточки блока «Что нового».
- Декоративные изображения (desktop):
  - на главной добавлен правый персонаж `human1_general.png`;
  - в уведомлениях добавлены:
    - справа `human2_frame_ball.png`,
    - слева `Vorona.png`.
  - позиционирование: по высоте по центру, справа/слева от интерфейса, только на широких экранах.
- Шаблоны страниц:
  - в `base.html` добавлен блок `body_class` для page-scoped стилей;
  - используются классы `page-index`, `page-reserve`, `page-notifications`.

### Изменения данных и конфигов

- Очищен `NEWS_CARDS` в `app.py` (убраны заглушки акций по умолчанию).
- Добавлены и обновлены ресурсы:
  - `backend/static/img/trash.png`
  - `backend/static/img/human1_general.png`
  - `backend/static/img/human2_frame_ball.png`
  - `backend/static/img/Vorona.png`
  - `backend/static/promo_items/reklama/item.txt`
  - `backend/static/promo_items/akciya/item.txt`

### Спринт 2 (2026-02-12)

- ### Оформление заказа и оплата:
  - добавлен полноценный flow `checkout -> payment -> confirm` с хранением заказов в `orders.json`;
  - добавлены страницы `checkout`, `payment`, `orders`, `order-detail`;
  - реализовано списание баллов при оплате (`use_points`, `points_applied`, `payable_total`);
  - добавлена валидация состояний оплаты: нет брони / бронь устарела / пустой заказ / нет карты;
  - переработана страница оплаты в state machine: `default`, `processing`, `success`, `error` (строго одно состояние на экране).

- ### Меню и корзина:
  - убрано управление количеством из карточек блюд;
  - кнопка в карточке переведена в режим `В корзину` / `Убрать` (`#7A3E3E`) в зависимости от наличия позиции в корзине;
  - корзина переработана в автопанель справа: появляется при первом товаре, скрывается при пустой корзине;
  - добавлены анимации корзины: slide/fade, settle, stagger, pop-in, remove, pulse суммы;
  - добавлена анимация изменения количества (роллер-эффект) в корзине и на странице checkout;
  - исправлены баги корзины: ложный блок “Корзина пуста”, отсутствие фото у позиций, мерцание списка при `+/-`.

- ### Фильтрация меню:
  - исправлена фильтрация категорий (нормализация типов + принудительное скрытие карточек), чтобы блюда не показывались в чужих категориях.

- ### Уведомления и статусы заказов:
  - добавлен пуш-тип уведомления `Заказ готовится`;
  - на главной странице добавлен блок статусов заказов (без состава и суммы);
  - в `Уведомлениях` добавлен состав заказа и сумма;
  - бейдж уведомлений учитывает брони + активные уведомления по заказам;
  - добавлено “окно готовки” 20 минут: уведомление `Заказ готовится` показывается только в расчётный интервал и автоматически скрывается после него.

- ### Исправления шаблонов:
  - устранены `TypeError` в шаблонах (`builtin_function_or_method is not iterable`) за счёт перехода на безопасный доступ через `.get(...)` в Jinja.
