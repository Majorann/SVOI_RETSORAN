# История изменений


## 2026-02-11

### Редизайн UI/UX и карточек меню
- Переработана верстка и поведение карточек меню в `backend/templates/menu.html` и `backend/static/css/style.css`:
  - слойная структура карточки (слой фото + слой контента),
  - более плавная переходная линия от фото к фону карточки,
  - усиленный неон вокруг всей карточки при `hover/focus`,
  - полное раскрытие `lore` при наведении/фокусе.
- Добавлен hover mood на уровне всей страницы в `backend/static/js/app.js`:
  - берется усредненный цвет из изображения позиции,
  - плавно меняется общий фон интерфейса,
  - цвет неона карточки синхронизируется с цветом позиции,
  - устранено мерцание при отведении курсора (через отложенный сброс).

### Авторизация / Профиль / Оплата
- Обновлена логика сессий и маршрутов профиля в `backend/app.py`:
  - добавлена более устойчивая постоянная авторизация,
  - профиль требует входа и при необходимости перенаправляет на страницу логина.
- Обновлена логика привязки карт в `backend/app.py`:
  - новые карты сохраняются с брендом `МИР`.

### Главная страница и блок новостей
- Обновлены `backend/templates/index.html` и `backend/static/css/style.css`:
  - убрана верхняя правая кнопка уведомлений на главной,
  - доработан блок «Что нового сегодня» (скругление и аккуратное поведение прокрутки).

### Источник данных меню
- Переведен источник данных меню на файловую структуру в `backend/app.py`:
  - чтение позиции из `backend/static/menu_items/<slug>/item.txt`,
  - использование `photo.png` из той же папки.
- Добавлена документация структуры и формата в `backend/README.md`.

### Актуализация данных
- Обновлено текущее состояние броней: `backend/bookings.json`.
### Редизайн UI (тёплая тёмная тема)
- Интерфейс переведён на тёплую тёмную палитру без синего неона.
- Обновлены токены цветов, контраст, поверхности и бордеры в `backend/static/css/style.css`.
- На главной странице пересобран порядок секций и улучшена визуальная иерархия в `backend/templates/index.html`.

### Типографика
- Весь интерфейс переведён на шрифт Inter:
  - подключение шрифта в `backend/templates/base.html`;
  - обновление `font-family` в `backend/static/css/style.css`.

### Схема зала и бронирование
- Доработана панель бронирования на схеме:
  - улучшены размеры, позиционирование и стабильность отображения;
  - исправлены отступы и внутренний layout формы.
- Восстановлен и усилен blur схемы:
  - общий blur при активной панели;
  - дополнительное затемнение и усиление blur во время ввода данных (`is-typing`).
- Доработан неон от столиков:
  - центр свечения привязан к выбранному столику;
  - улучшена форма свечения и убраны артефакты прямоугольного контейнера;
  - настроена интенсивность свечения для свободных и занятых столиков.

### Динамика фона по времени
- Реализована смена фона по выбранному времени бронирования (09:00–22:00) в `backend/static/js/app.js`.
- Добавлено мягкое смешивание оттенка времени с базовым фоном без резкой границы в `backend/static/css/style.css`.
- Обновлена палитра утро/день/вечер/ночь под медно-терракотовые тона.

### Анимации и взаимодействие
- Добавлен плавный индикатор активного раздела в нижней навигации (перетекающая капсула).
- Добавлена плавная анимация выбора времени в правом таймлайне (`timeline__active-indicator`).

### Нижняя навигация
- Нижняя навигация переведена в режим «только иконки» (без текста и эмодзи).
- Подключены PNG-иконки:
  - `backend/static/img/bell.png`
  - `backend/static/img/home.png`
  - `backend/static/img/profile.png`
- Настроены размеры иконок и позиционирование бейджа уведомлений.

### Статусы и цветовая система
- Унифицированы зелёные/красные статусы интерфейса:
  - зелёный: `#5E7F63`;
  - красный: `#7A3E3E`.
- Обновлены состояния кнопок, таймлайна, статусов столов и ошибок в едином стиле.

## 2026-02-12

### Исправления багов и ошибок

- Исправлен заметный микросдвиг нижней навигации между страницами:
  - добавлены `scrollbar-gutter: stable` и fallback `overflow-y: scroll` в `style.css`.
- Исправлено позиционирование неона на схеме зала:
  - центр неона теперь вычисляется от `.hall__map`, а не от контейнера свечения.
- Исправлен конфликт и дублирование неон-слоев на схеме:
  - удален первый (устаревший) блок фонового неона, оставлен один актуальный.
- Исправлен профиль красного неона занятых столов:
  - красный свет использует ту же геометрию свечения, что и зеленый, меняется только цвет.
- Исправлен визуальный разрез между фото блюда и фоном карточки при hover:
  - скорректированы размеры и смещение переходного градиента (`мыло`) и параметры масштаба.
- Исправлена видимость красного фонового tint:
  - эффект оставлен только на странице выбора столика (`/reserve`), убран с остальных страниц.
- Исправлены проблемы с текстовой кодировкой в `app.py`.

### Улучшения интерфейса и UX

- Главная:
  - переработан блок «Меню → Популярное»:
    - `type` вынесен в строку заголовка рядом с названием блюда;
    - обновлен стиль `type` (белый текст, рамка `rgb(216,163,127)`).
- Профиль:
  - добавлена кнопка удаления карты справа в каждой карточке оплаты;
  - стилизована как закругленный квадрат;
  - добавлена иконка мусорки из `static/img/trash.png`;
  - добавлен серверный маршрут `POST /cards/delete` с удалением карты и корректным пересчетом `active`.
- Меню:
  - полностью обновлен блок управления:
    - фильтр категорий в виде горизонтальных chips;
    - отдельный компактный dropdown сортировки;
    - сортировка: `По популярности`, `Цена ↑`, `Цена ↓`;
    - фильтр и сортировка работают совместно без перезагрузки;
    - добавлена анимация перестройки карточек (`fade + slide`, ~180ms).
  - добавлена поддержка популярности в модели блюда:
    - поля `popularity/orders_count` читаются из `menu_items/*/item.txt`.
  - hover-стиль карточек меню доработан:
    - `lore` становится белым;
    - фон карточки в hover: `#3C342D`;
    - увеличен масштаб карточки на hover;
    - неон у карточки переведен в тон акцента (`#cc7b57`) и вынесен под карточку (светит в фон).
  - активные filter-chip получили неоновую подсветку акцентного цвета.
- Промо и акции:
  - добавлен формат `promo_items` с поддержкой:
    - `reklama`: `text`, `link`;
    - `akciya`: `name`, `lore`;
    - опционального `photo.png`.
  - добавлена загрузка promo-блоков в `app.py` и преобразование в карточки блока «Что нового».
- Декоративные изображения (desktop):
  - на главной добавлен правый персонаж `human1_general.png`;
  - в уведомлениях добавлены:
    - справа `human2_frame_ball.png`,
    - слева `Vorona.png`.
  - позиционирование: по высоте по центру, справа/слева от интерфейса, только на широких экранах.
- Шаблоны страниц:
  - в `base.html` добавлен блок `body_class` для page-scoped стилей;
  - используются классы `page-index`, `page-reserve`, `page-notifications`.

### Изменения данных и конфигов

- Очищен `NEWS_CARDS` в `app.py` (убраны заглушки акций по умолчанию).
- Добавлены и обновлены ресурсы:
  - `backend/static/img/trash.png`
  - `backend/static/img/human1_general.png`
  - `backend/static/img/human2_frame_ball.png`
  - `backend/static/img/Vorona.png`
  - `backend/static/promo_items/reklama/item.txt`
  - `backend/static/promo_items/akciya/item.txt`
