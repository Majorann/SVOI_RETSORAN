FILE: Модульная_документация_СВОЙ_РЕСТОРАН.docx
---PARAGRAPHS---
001: МОДУЛЬНАЯ ДОКУМЕНТАЦИЯ
002: И ТЕСТ-ПЛАН
003: Учебный проект «Свой ресторан»  (KMPK_24-ABD-12)
004: Backend: Python / Flask · Хранилище: JSON-файлы
005: Ответственные функции: login(), register(), logout(), keep_user_session()
006: Шаблоны: templates/login.html, templates/register.html
008: Ответственные функции: reserve(), availability(), book_table(), cancel_booking(), overlaps_booking(), parse_datetime()
009: Шаблон: templates/reserve.html
011: Ответственные функции: load_menu_items(), parse_menu_meta(), parse_menu_item(), menu(), menu_item()
012: Файлы данных: static/menu_items/*/item.txt + photo.png
014: Ответственные функции: checkout(), payment(), payment_confirm(), resolve_order_items(), parse_serving_option(), latest_user_booking_status()
016: Ответственные функции: profile(), add_card(), delete_card()
017: Шаблон: templates/profile.html
019: Ответственные функции: orders(), order_detail(), notifications(), get_user_preparing_orders(), order_cooking_window(), compute_serve_datetime()
021: Ответственные функции: index(), load_promo_items(), parse_promo_item(), promo_items_to_news_cards()
022: Файлы данных: static/promo_items/*, templates/index.html
026: Маршрутизация
027: Проверить ключевые переходы: index → reserve → menu → checkout → payment → order-detail.
028: Проверить редиректы на /login для всех закрытых (авторизованных) страниц.
029: Целостность данных
030: После полного сценария (бронь + заказ + оплата) проверить согласованность bookings.json, orders.json, users.json.
031: Убедиться, что баллы корректно списываются и нигде не «задваиваются».
032: Нагрузочные и конкурентные проверки
033: Попытка одновременного бронирования одного стола на одинаковое время двумя пользователями.
034: Повторная отправка форм оплаты/брони (double-submit) — проверить отсутствие дублей.
035: Нефункциональные
036: Корректная работа на мобильных и desktop-разрешениях.
037: Проверка отображения кириллического текста и кодировок (UTF-8).
040: Монолитная структура app.py затрудняет масштабирование и модульное unit-тестирование.
041: Файловые JSON-хранилища не рассчитаны на высокую конкуренцию (отсутствует блокировка файлов).
042: Отсутствует полноценная production-безопасность: секреты в коде, SHA-256 без соли, нет CSRF-защиты и ограничений сессий.
043: POST /release является заглушкой и возвращает 501 — функциональность не реализована.
---TABLES---
[TABLE 1]
R01: 1. Модуль «Авторизация и сессия» | Ответственный код: /login, /register, /logout || 1. Модуль «Авторизация и сессия» | Ответственный код: /login, /register, /logout
[TABLE 2]
R01: Категория || Тест-сценарии
R02: Функциональное тестирование || Регистрация: создать нового пользователя с валидными полями, проверить редирект и вход в аккаунт. | Дубликат телефона: повторно зарегистрировать тот же номер, проверить сообщение об ошибке. | Вход: ввести корректные данные, проверить установку сессии и доступ к защищённым разделам. | Неверный пароль: проверить, что вход не выполняется и отображается ошибка. | Выход: вызвать /logout, проверить очистку session и недоступность защищённых разделов.
R03: UI/UX тестирование || Проверить отображение текста ошибок на формах входа и регистрации. | Проверить возврат пользователя на целевую страницу после успешного логина (next-параметр).
R04: Edge Cases || Пустые поля формы — форма не должна отправляться. | Лишние пробелы в имени/телефоне — проверить обрезку (strip). | Попытка зарегистрироваться с уже существующим аккаунтом.
R05: Безопасность ⚠️ || Пароли хешируются SHA-256 без соли — для учебного проекта допустимо, для продакшена недостаточно. | secret_key хранится в коде ('replace-me-in-production') — необходимо вынести в переменные окружения (.env).
[TABLE 3]
R01: 2. Модуль «Бронирование столов» | Ответственный код: /reserve, /availability, /book, /bookings/cancel || 2. Модуль «Бронирование столов» | Ответственный код: /reserve, /availability, /book, /bookings/cancel
[TABLE 4]
R01: Категория || Тест-сценарии
R02: Функциональное тестирование || Отрисовка зала: проверить, что занятые столы помечаются корректно по выбранной дате/времени. | Проверка доступности: GET /availability?date=YYYY-MM-DD&time=HH:MM возвращает статус reserved. | Создание брони: POST /book (JSON) с валидными данными создаёт запись в bookings.json. | Конфликт брони: попытка занять уже занятый стол на пересекающееся время — возвращает 409. | Отмена брони: POST /bookings/cancel удаляет только бронь текущего пользователя (не чужую).
R03: Валидация || Запрет брони в прошедшем времени — должна возвращаться ошибка 400. | Ошибки 400 при неполных или невалидных значениях date/time. | Ошибка 401 при попытке бронирования без авторизации — редирект на /login.
R04: Edge Cases || Пограничные значения времени (ровно на границе окна 60 минут). | Несколько броней подряд у одного пользователя на разные столы. | Попытка отменить чужую бронь — должна возвращать 403.
[TABLE 5]
R01: 3. Модуль «Меню и карточки блюд» | Ответственный код: /menu, /menu/<id> || 3. Модуль «Меню и карточки блюд» | Ответственный код: /menu, /menu/<id>
[TABLE 6]
R01: Категория || Тест-сценарии
R02: Функциональное тестирование || Каталог: проверить загрузку позиций из item.txt + photo.png по каждой папке. | Сортировка/порядок: убедиться, что позиции отображаются в порядке по полю id. | Страница блюда: открыть валидный /menu/<id>, убедиться в корректных данных (название, цена, описание, фото). | 404: открыть несуществующий id, проверить страницу-заглушку и код ответа 404.
R03: Проверка данных || Некорректный item.txt (пустой или неполный) не должен ломать весь каталог. | Отсутствие photo.png или item.txt в папке позиции — папка должна безопасно пропускаться.
R04: UI/UX тестирование || Проверить корректный рендер: фото, название, цену, описание. | Проверить адаптивность сетки каталога на мобильных устройствах.
[TABLE 7]
R01: 4. Модуль «Оформление заказа и оплата» | Ответственный код: /checkout, /payment, /payment/confirm || 4. Модуль «Оформление заказа и оплата» | Ответственный код: /checkout, /payment, /payment/confirm
[TABLE 8]
R01: Категория || Тест-сценарии
R02: Функциональное тестирование || Без авторизации — редирект на /login для всех маршрутов раздела. | Валидации оплаты: нет активной брони; бронь просрочена; пустая корзина; нет активной карты — каждая ситуация выдаёт понятное сообщение об ошибке. | Предпросмотр оплаты: после POST /payment проверить корректные суммы items_total, points_applied, payable_total. | Подтверждение: POST /payment/confirm создаёт заказ в orders.json. | Баллы: при use_points=1 баллы корректно списываются из users.json. | AJAX-подтверждение: при заголовке X-Requested-With: XMLHttpRequest возвращается JSON с полем order_url.
R03: Edge Cases || Некорректный items_json в теле запроса — должен возвращать 400. | Кастомное время подачи вне окна брони — должен быть отказ. | Повторный POST /payment/confirm с устаревшим checkout_preview — должна обрабатываться корректно.
[TABLE 9]
R01: 5. Модуль «Профиль, карты и баллы» | Ответственный код: /profile, /cards/add, /cards/delete || 5. Модуль «Профиль, карты и баллы» | Ответственный код: /profile, /cards/add, /cards/delete
[TABLE 10]
R01: Категория || Тест-сценарии
R02: Функциональное тестирование || Страница профиля доступна только авторизованному пользователю. | Добавление карты: номер карты валидируется по количеству цифр; при добавлении новая карта становится active, старые сбрасываются. | Удаление карты: по полям created_at или last4; при удалении активной карты автоматически выбирается следующая активная (если есть).
R03: Edge Cases || Удаление несуществующей карты — должна возвращаться ошибка. | Пользователь без карт — попытка оплаты должна блокироваться. | Одновременное добавление карты с одинаковым last4 — проверить дедупликацию.
[TABLE 11]
R01: 6. Модуль «Заказы и уведомления» | Ответственный код: /orders, /orders/<id>, /notifications || 6. Модуль «Заказы и уведомления» | Ответственный код: /orders, /orders/<id>, /notifications
[TABLE 12]
R01: Категория || Тест-сценарии
R02: Функциональное тестирование || /orders: страница показывает только заказы текущего пользователя, не чужие. | /orders/<id>: чужой заказ не должен открываться — возвращать 403. | /notifications: отображает уведомления по броням и активным заказам. | Проверка окна готовки: временная логика показа статуса «готовится» работает корректно.
R03: Edge Cases || Пустой список заказов — отображается заглушка «У вас нет заказов». | Удалённая или просроченная бронь при существующем заказе — заказ всё равно отображается.
[TABLE 13]
R01: 7. Модуль «Главная и промо-контент» | Ответственный код: /, promo_items || 7. Модуль «Главная и промо-контент» | Ответственный код: /, promo_items
[TABLE 14]
R01: Категория || Тест-сценарии
R02: Функциональное тестирование || Блок новостей/промо заполняется из promo_items при наличии данных. | При отсутствии промо-данных используется fallback NEWS_CARDS — проверить содержимое. | Блок «Популярное»: при featured=true показываются отмеченные блюда; иначе — первые 3 из каталога. | Для авторизованного пользователя на главной отображаются его активные брони и заказы в процессе готовки.
R03: Edge Cases || Битый формат item.txt у промо — не должен ломать всю главную страницу. | Промо без фото — должна использоваться заглушка изображения.
[TABLE 15]
R01: 8. Глобальное интеграционное тестирование
[TABLE 16]
R01: 9. Известные ограничения проекта