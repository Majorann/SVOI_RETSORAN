{% extends "base.html" %}
{% block content %}
<header class="top menu-top">
  <div class="brand">
    <div class="brand__mark">С</div>
    <div>
      <p class="brand__name">Меню</p>
      <p class="brand__tag">Выберите блюда</p>
    </div>
  </div>
  <div class="menu-top__actions">
    <a class="icon-button" href="{{ url_for('index') }}" aria-label="Назад">←</a>
    <button class="cart-button" id="cartButton" type="button" aria-label="Корзина">
      🧺
      <span class="cart-badge" id="cartBadge">0</span>
    </button>
  </div>
</header>

<section class="section">
  <div class="menu-controls">
    <div class="menu-categories" id="menuCategoryChips" role="tablist" aria-label="Категории">
      <button class="menu-chip is-active" type="button" data-type="all">Все</button>
      <button class="menu-chip" type="button" data-type="Закуски">Закуски</button>
      <button class="menu-chip" type="button" data-type="Салаты">Салаты</button>
      <button class="menu-chip" type="button" data-type="Супы">Супы</button>
      <button class="menu-chip" type="button" data-type="Горячие блюда">Горячие</button>
      <button class="menu-chip" type="button" data-type="Десерты">Десерты</button>
      <button class="menu-chip" type="button" data-type="Напитки">Напитки</button>
      <button class="menu-chip" type="button" data-type="Алкогольные напитки">Алкоголь</button>
    </div>
    <div class="sort-control">
      <button class="sort-toggle" id="sortToggle" type="button" aria-haspopup="listbox" aria-expanded="false">
        Сортировать
        <span class="sort-toggle__value" id="sortValue">По популярности</span>
        <span class="sort-toggle__arrow">▾</span>
      </button>
      <div class="sort-menu" id="sortMenu" role="listbox" aria-hidden="true">
        <button class="sort-option is-active" type="button" data-sort="popular">
          <span>По популярности</span>
          <span class="sort-option__check">✓</span>
        </button>
        <button class="sort-option" type="button" data-sort="price-asc">
          <span>Цена ↑</span>
          <span class="sort-option__check">✓</span>
        </button>
        <button class="sort-option" type="button" data-sort="price-desc">
          <span>Цена ↓</span>
          <span class="sort-option__check">✓</span>
        </button>
      </div>
    </div>
  </div>
</section>

<section class="section">
  <div class="menu">
    {% for item in items %}
      <article class="menu-card menu-card--menu" data-type="{{ item.type }}" data-price="{{ item.price }}" data-popularity="{{ item.popularity or item.orders_count or 0 }}" style="--dish-photo: url('{{ url_for('static', filename=item.photo) }}');">
        <div class="menu-card__media" style="background-image: var(--dish-photo);">
        </div>
        <div class="menu-card__content">
          <div class="menu-card__text">
            <div class="menu-card__title-row">
              <h3>{{ item.name }}</h3>
              <span class="menu-type menu-type--{{ item.type|replace(' ', '-')|lower }}">{{ item.type }}</span>
            </div>
            <p class="menu-card__lore">{{ item.lore }}</p>
            <div class="menu-card__bottom">
              <span class="price">{{ item.price }} ₽</span>
              <button class="add-button" type="button" data-id="{{ item.id }}" data-name="{{ item.name }}" data-price="{{ item.price }}">В корзину</button>
            </div>
          </div>
        </div>
      </article>
    {% endfor %}
  </div>
</section>

<div class="cart-drawer" id="cartDrawer" aria-hidden="true">
  <div class="cart-drawer__header">
    <h3>Корзина</h3>
    <button class="icon-button" id="cartClose" type="button">✕</button>
  </div>
  <div class="cart-drawer__list" id="cartList"></div>
  <div class="cart-drawer__footer">
    <div class="cart-drawer__total">Итого: <span id="cartTotal">0</span> ₽</div>
    <button class="primary-action" id="cartCheckout" type="button">Оформить</button>
  </div>
</div>

<nav class="bottom-nav">
  <a class="bottom-nav__item" href="{{ url_for('notifications') }}">
    <span>🔔</span>
    <span>Уведомления</span>
    {% if notifications_count %}
      <span class="nav-badge">{{ notifications_count }}</span>
    {% endif %}
  </a>
  <a class="bottom-nav__item" href="{{ url_for('index') }}">
    <span>🏠</span>
    <span>Главная</span>
  </a>
  <a class="bottom-nav__item" href="{{ url_for('profile') }}">
    <span>👤</span>
    <span>Профиль</span>
  </a>
</nav>
{% endblock %}
