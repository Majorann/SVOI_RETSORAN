{% extends "base.html" %}
{% block body_class %}page-checkout page-checkout-payment{% endblock %}
{% block content %}
<header class="top checkout-head" id="checkoutHead">
  <div class="brand">
    <div class="brand__mark">–°</div>
    <div>
      <p class="brand__name">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ</p>
      <p class="brand__tag">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞ –ø–µ—Ä–µ–¥ –æ–ø–ª–∞—Ç–æ–π</p>
    </div>
  </div>
  <a class="icon-button" href="{{ url_for('menu') }}" aria-label="–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é">‚Üê</a>
</header>

{% if checkout_error %}
<section class="section">
  <div class="notice notice--error">{{ checkout_error }}</div>
</section>
{% endif %}

<script type="application/json" id="menuCatalogJson">{{ menu_catalog | tojson }}</script>

{% if checkout_state != "active" %}
<section class="section checkout-state-card">
  {% if checkout_state == "expired_booking" %}
    <h2>–í–∞—à–∞ –±—Ä–æ–Ω—å –±–æ–ª—å—à–µ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞</h2>
    <p>–ó–∞–±—Ä–æ–Ω–∏—Ä—É–π—Ç–µ —Å—Ç–æ–ª–∏–∫ –∑–∞–Ω–æ–≤–æ, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞.</p>
    <a class="primary-action" href="{{ url_for('reserve') }}">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞–Ω–æ–≤–æ</a>
  {% else %}
    <h2>–°–Ω–∞—á–∞–ª–∞ –∑–∞–±—Ä–æ–Ω–∏—Ä—É–π—Ç–µ —Å—Ç–æ–ª–∏–∫</h2>
    <p>–î–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –æ–ø–ª–∞—Ç–µ –Ω—É–∂–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞—è –±—Ä–æ–Ω—å.</p>
    <a class="primary-action" href="{{ url_for('reserve') }}">–ü–µ—Ä–µ–π—Ç–∏ –∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é</a>
  {% endif %}
</section>
{% else %}
<form class="checkout-layout" method="post" action="{{ url_for('payment') }}" id="checkoutForm">
  <input type="hidden" name="items_json" id="checkoutItemsJson" value="[]" />

  <div class="checkout-main">
    <section class="section">
      <div class="section__title">
        <h2>–ë—Ä–æ–Ω—å</h2>
      </div>
      <div class="checkout-card">
        <div class="checkout-booking">
          <div>
            <p class="checkout-booking__title">–°—Ç–æ–ª–∏–∫ ‚Ññ{{ booking.table_id }}</p>
            <p class="checkout-booking__meta">{{ booking.date }} ¬∑ {{ booking.time }}</p>
          </div>
          <span class="pill">–ê–∫—Ç–∏–≤–Ω–∞</span>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="section__title">
        <h2>–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞</h2>
      </div>
      <div class="checkout-card">
        <div class="checkout-items" id="checkoutItems"></div>
        <div class="checkout-empty notice notice--empty" id="checkoutEmpty">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
        <div class="checkout-summary">
          <span>–ò—Ç–æ–≥ –ø–æ –ø–æ–∑–∏—Ü–∏—è–º</span>
          <strong><span id="checkoutItemsTotal">0</span> ‚ÇΩ</strong>
        </div>
        <a class="booking-card__action" href="{{ url_for('menu') }}">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é</a>
      </div>
    </section>

    <section class="section">
      <div class="section__title">
        <h2>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É</h2>
      </div>
      <div class="checkout-card">
        <p class="field">–ü–æ–∂–µ–ª–∞–Ω–∏—è –¥–ª—è –∫—É—Ö–Ω–∏</p>
        <label class="checkout-comment">
          <textarea
            id="checkoutComment"
            name="comment"
            maxlength="300"
            rows="4"
            placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –±–µ–∑ –ª—É–∫–∞, –∞–ª–ª–µ—Ä–≥–∏—è –Ω–∞ –æ—Ä–µ—Ö–∏..."
          ></textarea>
        </label>
        <div class="checkout-counter"><span id="checkoutCommentCount">0</span> / 300</div>
      </div>
    </section>

    <section class="section">
      <div class="section__title">
        <h2>–ü–æ–¥–∞—á–∞</h2>
      </div>
      <div class="checkout-card checkout-serving">
        <label><input type="radio" name="serve_mode" value="booking_start" checked /> –ö –Ω–∞—á–∞–ª—É –±—Ä–æ–Ω–∏</label>
        <label><input type="radio" name="serve_mode" value="plus_15" /> –ß–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç</label>
        <label><input type="radio" name="serve_mode" value="plus_30" /> –ß–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç</label>
        <label><input type="radio" name="serve_mode" value="plus_45" /> –ß–µ—Ä–µ–∑ 45 –º–∏–Ω—É—Ç</label>
        <label><input type="radio" name="serve_mode" value="plus_60" /> –ß–µ—Ä–µ–∑ 60 –º–∏–Ω—É—Ç</label>
        <label class="checkout-serving__custom">
          <input type="radio" name="serve_mode" value="custom" /> –í —Å–≤–æ—ë –≤—Ä–µ–º—è
          <input
            type="time"
            name="serve_custom_time"
            id="serveCustomTime"
            min="{{ booking.time }}"
            {% if custom_time_max %}max="{{ custom_time_max }}"{% endif %}
          />
        </label>
      </div>
    </section>
  </div>

  <aside class="checkout-side">
    <section class="section">
      <div class="section__title">
        <h2>–ò—Ç–æ–≥–æ</h2>
      </div>
      <div class="checkout-card checkout-total checkout-total--fixed" id="checkoutTotalPanel">
        <div class="checkout-brief-list" id="checkoutSummaryList"></div>
        <p class="checkout-total__hint">–°—É–º–º–∞: <span id="checkoutTotal">0</span> ‚ÇΩ</p>
        <label class="checkout-points">
          <input type="checkbox" name="use_points" id="usePoints" value="1" {% if user_balance <= 0 %}disabled{% endif %} />
          <span>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–ª–ª—ã</span>
        </label>
        <p class="checkout-total__hint">–î–æ—Å—Ç—É–ø–Ω–æ –±–∞–ª–ª–æ–≤: <span id="availablePoints">{{ user_balance }}</span></p>
        <p class="checkout-total__hint">–°–ø–∏—Å–∞—Ç—å –±–∞–ª–ª–æ–≤: <span id="checkoutPointsApplied">0</span> ‚ÇΩ</p>
        <p class="checkout-total__value">–ö –æ–ø–ª–∞—Ç–µ: <span id="checkoutPayable">0</span> ‚ÇΩ</p>
        <button class="primary-action" type="submit" id="goToPayment"{% if not active_card %} disabled{% endif %}>–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ</button>
        <p class="checkout-total__hint">–û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–æ–π –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è</p>
        {% if active_card %}
          <p class="checkout-total__hint">–ê–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞: {{ active_card.brand }} ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ {{ active_card.last4 }}</p>
        {% else %}
          <p class="notice notice--error">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ä—Ç—ã. –î–æ–±–∞–≤—å—Ç–µ –∫–∞—Ä—Ç—É –≤ –ø—Ä–æ—Ñ–∏–ª–µ.</p>
        {% endif %}
      </div>
    </section>
  </aside>
</form>

{% endif %}

<nav class="bottom-nav">
  <a class="bottom-nav__item" href="{{ url_for('notifications') }}">
    <span>üîî</span>
    <span>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
    {% if notifications_count %}
      <span class="nav-badge">{{ notifications_count }}</span>
    {% endif %}
  </a>
  <a class="bottom-nav__item" href="{{ url_for('index') }}">
    <span>üè†</span>
    <span>–ì–ª–∞–≤–Ω–∞—è</span>
  </a>
  <a class="bottom-nav__item bottom-nav__item--active" href="{{ url_for('profile') }}">
    <span>üë§</span>
    <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
  </a>
</nav>
{% endblock %}
